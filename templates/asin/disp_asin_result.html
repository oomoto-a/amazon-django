{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}
{% load render_table from django_tables2 %}

{% block title %}ASIN取得結果{% endblock %}

{% block contents %}
 <section>
	<div class="section-header">
		<h1> ASIN取得結果 </h1>
	</div>
	<p></p>
	<div class="container" style="max-width: 100%;">
		<div class="row">
			<div class="col-12 col-md-12 col-lg-12">
				<div class="card">
					<div class="card-header">
						<form method="GET" action="{% url 'asin:disp_asin_result' %}">
							
							{{ form.hidden_asin_group_id.as_hidden  }}
							{{ form.lowest_price_start.as_hidden  }}
							{{ form.lowest_price_end.as_hidden  }}
							{{ form.lowest_price_fbm_start.as_hidden  }}
							{{ form.lowest_price_fbm_end.as_hidden  }}
							{{ form.lowest_price_fba_start.as_hidden  }}
							{{ form.lowest_price_fba_end.as_hidden  }}
							<div class="">
								<div class="row justify-content-md-center">
									<div class="col-md-auto">
										{{ form.asin_group_id.label }}
									</div>
									<div class="col-md-auto">
										{{ form.asin_group_id }}
									</div>
									<div class="col-md-auto">
										<button type='submit' class='btn btn-primary'>表示切替</button>
									</div>
									<div class="col-md-auto">
										<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal1">
											フィルタ設定
										</button>
									</div>
									<div class="col-md-auto">
										<a href="{% url 'asin:download' form.hidden_asin_group_id.value %}{{parameter}}" class="btn btn-primary" >
											download</a>

										
									</div>
								</div>
								<div class="row">
									<div class="col-md-auto">
										{{ table.rows|length }}件取得しました
									</div>
								</div>
							</div>
						</form>
					</div>
					<div class="card-body " style="overflow: scroll;max-height: 600px;">

						{% render_table table %}
						{% comment %}
						{% for table in tables %}
							{% render_table table  %}
						{% endfor %}
						{% endcomment %}
						
					</div>
				</div>
			</div>
		</div>
	</div>
</section>


{% endblock %}

{% block script %}
	<script type="text/javascript">
		function setSelectValue(){
			// select設定
			selected_value=$("input[name=hidden_asin_group_id]").val();
			if(selected_value){
				$("select").val(selected_value)
			}
		}
        // 初期処理
        $(document).ready(function(event){
			// select設定
			setSelectValue();
			//バリエーション情報の初期処理
			$(".variations_id").hide();
			$("td","#variationmodal").hide();
        });
		function dispVariationModal(id){
			// バリエーション情報のリンク押下対応
			$("td","#variationmodal").hide();
			$.each($("tr","#variationmodal"), function(key, val) {
				row_id = $("td.variations_id",val).text()
				if(id == row_id){
					$("td:not(.variations_id)",val).show();
				}
			});
			$("#variationmodal").modal('show');
		}
		$(document).on("click", "#modalOk", function () {
			// フィルターのモーダルOKボタン押下

			// select設定しなおす（テーブルと、selectのグループIDを合わせる）
			setSelectValue();

			$("#id_lowest_price_start").val($("#lowestPriceStart").val());
			$("#id_lowest_price_end").val($("#lowestPriceEnd").val());
			$("#id_lowest_price_fbm_start").val($("#lowestPriceFbmStart").val());
			$("#id_lowest_price_fbm_end").val($("#lowestPriceFbmEnd").val());
			$("#id_lowest_price_fba_start").val($("#lowestPriceFbaStart").val());
			$("#id_lowest_price_fba_end").val($("#lowestPriceFbaEnd").val());
			$("button[type='submit']").click();
		});

	</script>
{% endblock %}